{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["api_request_body", "lookups_required", "validation"],
  "properties": {
    "api_request_body": {
      "type": "object",
      "description": "Complete API request body ready to POST to accounting software",
      "additionalProperties": true
    },
    "lookups_required": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["entity", "field", "lookup_value"],
        "properties": {
          "entity": {
            "type": "string",
            "description": "Entity type (Customer, Vendor, Item, Account)"
          },
          "field": {
            "type": "string",
            "description": "Field name in api_request_body that needs lookup"
          },
          "lookup_value": {
            "type": "string",
            "description": "Value to search for in entity database"
          },
          "create_if_missing": {
            "type": "boolean",
            "description": "Whether to create entity if not found"
          }
        }
      }
    },
    "validation": {
      "type": "object",
      "required": ["warnings", "missing_fields"],
      "properties": {
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Non-critical warnings about the mapping"
        },
        "missing_fields": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Required fields that are missing from document"
        }
      }
    }
  }
}
